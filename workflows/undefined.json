{
  "createdAt": "2025-08-23T22:46:32.047Z",
  "updatedAt": "2025-10-09T08:02:18.000Z",
  "id": "SupOl9rOlZ62N5lV",
  "name": "My workflow",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "id": "99b39756-d07b-4570-b98d-4ac7e9c6c794",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -1008,
        48
      ]
    },
    {
      "parameters": {
        "functionCode": "// Configuration - Modify these parameters as needed\nconst CONFIG = {\n  symbols: ['MERLUSDT', 'ZKJUSDT', 'BUSDT', 'KERNELUSDT', 'RESOLVUSDT', 'HYPERUSDT', 'MILKUSDT', 'OBOLUSDT', 'UNIUSDT', 'DEEPUSDT', 'ALPINEUSDT', 'WALUSDT', 'FORTHUSDT', 'SKATEUSDT', 'PROMPTUSDT', 'GUNUSDT', 'BABYUSDT', 'STOUSDT', 'FISUSDT', 'ASRUSDT', 'MLNUSDT', 'TANSSIUSDT', 'AIOTUSDT', 'SKYAIUSDT'],\n  percentageThreshold: 5,\n  candleCount: 10,\n  retraceCount: 5,\n  bollingerPeriod: 20,\n  bollingerStdDev: 2,\n  proximityThreshold: 0.02,\n  interval: '15m'\n};\n\nreturn [\n  {\n    json: {\n      config: CONFIG,\n      timestamp: new Date().toISOString()\n    }\n  }\n];"
      },
      "id": "a4ccd36d-23fa-4dc9-ab46-f205a9d858fe",
      "name": "Strategy Configuration",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -784,
        48
      ]
    },
    {
      "parameters": {
        "functionCode": "const config = items[0].json.config;\nconst outputs = [];\n\nconfig.symbols.forEach((symbol, index) => {\n  outputs.push({\n    json: {\n      symbol: symbol,\n      config: config,\n      symbolIndex: index\n    }\n  });\n});\n\nreturn outputs;"
      },
      "id": "26b6409f-43e1-421f-9b82-41aa1e41586e",
      "name": "Split Symbols",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -560,
        48
      ]
    },
    {
      "parameters": {
        "url": "=https://fapi.binance.com/fapi/v1/klines",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "id": "3ae45f6d-a276-4cff-9b59-5faa022c218e",
      "name": "Fetch Binance Klines",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -336,
        48
      ]
    },
    {
      "parameters": {
        "functionCode": "const symbol = items[0].json.symbol;\nconst config = items[0].json.config;\nconst klines = items[0].json;\n\nif (!Array.isArray(klines) || klines.length === 0) {\n  return [{\n    json: {\n      symbol: symbol,\n      error: 'No klines data available',\n      timestamp: new Date().toISOString()\n    }\n  }];\n}\n\nconst candles = klines.map(k => ({\n  time: k[0],\n  open: parseFloat(k[1]),\n  high: parseFloat(k[2]),\n  low: parseFloat(k[3]),\n  close: parseFloat(k[4]),\n  volume: parseFloat(k[5])\n})).reverse();\n\nfunction calculateBollingerBands(closes, period = 20, stdDev = 2) {\n  if (closes.length < period) return null;\n  \n  const relevantCloses = closes.slice(-period);\n  const mean = relevantCloses.reduce((sum, close) => sum + close, 0) / period;\n  \n  const variance = relevantCloses.reduce((sum, close) => sum + Math.pow(close - mean, 2), 0) / period;\n  const standardDeviation = Math.sqrt(variance);\n  \n  return {\n    upper: mean + (standardDeviation * stdDev),\n    middle: mean,\n    lower: mean - (standardDeviation * stdDev)\n  };\n}\n\nconst candlesWithBB = candles.map((candle, index) => {\n  const closes = candles.slice(0, index + 1).map(c => c.close);\n  const bb = calculateBollingerBands(closes, config.bollingerPeriod, config.bollingerStdDev);\n  \n  return {\n    ...candle,\n    bb: bb,\n    isGreen: candle.close > candle.open,\n    isRed: candle.close < candle.open,\n    percentChange: ((candle.close - candle.open) / candle.open) * 100\n  };\n}).filter(c => c.bb !== null);\n\nif (candlesWithBB.length < config.candleCount + config.retraceCount) {\n  return [{\n    json: {\n      symbol: symbol,\n      error: 'Insufficient data for analysis',\n      timestamp: new Date().toISOString()\n    }\n  }];\n}\n\nconst recentCandles = candlesWithBB.slice(0, config.candleCount + config.retraceCount);\nconst initialCandles = recentCandles.slice(config.retraceCount);\nconst retraceCandles = recentCandles.slice(0, config.retraceCount);\nconst currentCandle = candlesWithBB[0];\n\nlet strongUpMove = false;\nlet strongDownMove = false;\nlet initialDirection = null;\n\nconst initialStart = initialCandles[initialCandles.length - 1].close;\nconst initialEnd = initialCandles[0].close;\nconst totalMovement = ((initialEnd - initialStart) / initialStart) * 100;\n\nif (Math.abs(totalMovement) >= config.percentageThreshold) {\n  if (totalMovement > 0) {\n    strongUpMove = true;\n    initialDirection = 'up';\n  } else {\n    strongDownMove = true;\n    initialDirection = 'down';\n  }\n}\n\nlet hasRetraced = false;\nlet retraceDirection = null;\n\nif (strongUpMove || strongDownMove) {\n  const retraceStart = retraceCandles[retraceCandles.length - 1].close;\n  const retraceEnd = retraceCandles[0].close;\n  const retraceMovement = ((retraceEnd - retraceStart) / retraceStart) * 100;\n  \n  if (strongUpMove && retraceMovement < -2) {\n    hasRetraced = true;\n    retraceDirection = 'down';\n  } else if (strongDownMove && retraceMovement > 2) {\n    hasRetraced = true;\n    retraceDirection = 'up';\n  }\n}\n\nconst currentPrice = currentCandle.close;\nconst currentMiddleBB = currentCandle.bb.middle;\nconst distanceFromMiddleBB = Math.abs(currentPrice - currentMiddleBB) / currentMiddleBB;\nconst nearMiddleBB = distanceFromMiddleBB <= config.proximityThreshold;\n\nlet signal = null;\nlet signalStrength = 0;\n\nif ((strongUpMove || strongDownMove) && hasRetraced && nearMiddleBB) {\n  if (strongUpMove) {\n    signal = 'BUY';\n    signalStrength = Math.abs(totalMovement) * (1 - distanceFromMiddleBB);\n  } else {\n    signal = 'SELL';\n    signalStrength = Math.abs(totalMovement) * (1 - distanceFromMiddleBB);\n  }\n}\n\nreturn [{\n  json: {\n    symbol: symbol,\n    signal: signal,\n    signalStrength: signalStrength,\n    analysis: {\n      initialDirection: initialDirection,\n      totalMovement: totalMovement.toFixed(2),\n      hasRetraced: hasRetraced,\n      retraceDirection: retraceDirection,\n      nearMiddleBB: nearMiddleBB,\n      distanceFromMiddleBB: (distanceFromMiddleBB * 100).toFixed(2),\n      currentPrice: currentPrice,\n      middleBB: currentMiddleBB.toFixed(4),\n      upperBB: currentCandle.bb.upper.toFixed(4),\n      lowerBB: currentCandle.bb.lower.toFixed(4)\n    },\n    candleData: {\n      totalCandles: candlesWithBB.length,\n      initialCandles: initialCandles.length,\n      retraceCandles: retraceCandles.length\n    },\n    timestamp: new Date().toISOString(),\n    config: config\n  }\n}];"
      },
      "id": "331e8c9b-de7e-4dd4-b346-9c9a449029a1",
      "name": "Analyze Bollinger Strategy",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -128,
        48
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.signal }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "d3c07013-15d3-4f8a-9f59-3b27e89addc8",
      "name": "Filter Valid Signals",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        80,
        -160
      ]
    },
    {
      "parameters": {
        "functionCode": "const data = items[0].json;\n\nconst message = `ðŸš¨ BOLLINGER RETRACEMENT SIGNAL ðŸš¨\\n\\n` +\n  `Symbol: ${data.symbol}\\n` +\n  `Signal: ${data.signal}\\n` +\n  `Signal Strength: ${data.signalStrength.toFixed(2)}\\n\\n` +\n  `Analysis:\\n` +\n  `â€¢ Initial Movement: ${data.analysis.totalMovement}% ${data.analysis.initialDirection}\\n` +\n  `â€¢ Has Retraced: ${data.analysis.hasRetraced} (${data.analysis.retraceDirection})\\n` +\n  `â€¢ Near Middle BB: ${data.analysis.nearMiddleBB}\\n` +\n  `â€¢ Distance from Middle BB: ${data.analysis.distanceFromMiddleBB}%\\n\\n` +\n  `Current Prices:\\n` +\n  `â€¢ Current Price: $${data.analysis.currentPrice}\\n` +\n  `â€¢ Upper BB: $${data.analysis.upperBB}\\n` +\n  `â€¢ Middle BB: $${data.analysis.middleBB}\\n` +\n  `â€¢ Lower BB: $${data.analysis.lowerBB}\\n\\n` +\n  `Strategy: Price expected to continue ${data.analysis.initialDirection}ward after BB retracement\\n` +\n  `Time: ${data.timestamp}`;\n\nreturn [\n  {\n    json: {\n      message: message,\n      symbol: data.symbol,\n      signal: data.signal,\n      signalStrength: data.signalStrength,\n      analysis: data.analysis,\n      timestamp: data.timestamp\n    }\n  }\n];"
      },
      "id": "8c399623-b105-4548-8762-e3670991db75",
      "name": "Format Notification",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        320,
        -32
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "6cef7380-81b1-4a04-a1d5-5e49f2fad038",
      "name": "Send Telegram Alert",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        544,
        -32
      ],
      "webhookId": "f230b340-f4ad-4c64-8ba7-f42c55894a45"
    },
    {
      "parameters": {
        "functionCode": "const data = items[0].json;\n\nconst logEntry = {\n  timestamp: data.timestamp,\n  symbol: data.symbol,\n  signal: data.signal,\n  signalStrength: data.signalStrength,\n  analysis: data.analysis,\n  action: 'signal_generated'\n};\n\nconsole.log('BOLLINGER STRATEGY LOG:', JSON.stringify(logEntry, null, 2));\n\nreturn [\n  {\n    json: logEntry\n  }\n];"
      },
      "id": "6c460432-e5a9-48b2-8fb1-1dffaa349bfe",
      "name": "Log Analysis Results",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        320,
        256
      ]
    },
    {
      "parameters": {
        "functionCode": "const data = items[0].json;\n\nif (!data.signal) {\n  console.log(`${data.symbol}: No signal - Initial: ${data.analysis.initialDirection} ${data.analysis.totalMovement}%, Retraced: ${data.analysis.hasRetraced}, Near BB: ${data.analysis.nearMiddleBB}`);\n}\n\nreturn items;"
      },
      "id": "994a0794-006d-4302-8e49-43cf3e39ff37",
      "name": "Debug Output",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -48,
        288
      ]
    }
  ],
  "connections": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "921bff53-e2c8-4a4b-9212-5d0976d25089",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-08-23T22:46:32.058Z",
      "updatedAt": "2025-08-23T22:46:32.058Z",
      "role": "workflow:owner",
      "workflowId": "SupOl9rOlZ62N5lV",
      "projectId": "X54hljIRMdcuCgG9"
    }
  ],
  "tags": [
    {
      "createdAt": "2025-08-23T22:43:38.492Z",
      "updatedAt": "2025-08-23T22:43:38.492Z",
      "id": "fOqY3qvMrxFZ1H7o",
      "name": "Trading Strategy"
    }
  ]
}