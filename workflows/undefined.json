{
  "createdAt": "2025-08-21T03:43:19.048Z",
  "updatedAt": "2025-10-11T06:37:04.000Z",
  "id": "OS1uzjjqwkm8WaCk",
  "name": "Minta",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 15
            }
          ]
        }
      },
      "id": "735bd6b5-594c-4dda-9c6e-450e090f3db9",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        -2960,
        -304
      ]
    },
    {
      "parameters": {
        "jsCode": "// Token list from your strategy\nconst tokens = [\n  \"ALPINEUSDT\"\n];\n\n// For each token, create a proper prompt for the AI agent\nconst items = tokens.map(symbol => ({\n  json: { \n    chatInput: `Analyze trading patterns for ${symbol}. The most important thing about your analysis is to find candle and price patterns that result in a predictable price movement. Detect these specific patterns:\n\n**PRIORITY PATTERNS TO DETECT:**\n\n1. LARGE CANDLE PATTERN\n   - Detect when current candle body is 2x or more the average body size of last 20 candles\n   - Indicate direction (bullish/bearish)\n   - Check if this occurs at support/resistance levels\n\n2. THREE CONSECUTIVE SMALL CANDLES (Same Direction)\n   - Find 3 consecutive candles with bodies < 0.5x average\n   - All moving in same direction (all green or all red)\n   - This indicates continuation potential\n\n3. REVERSAL SETUP PATTERN\n   - Find: 3 small consecutive candles THEN a reversal candle\n   - Reversal candle must:\n     * NOT be the current/most recent candle\n     * Have very small or NO wick in reversal direction (< 10% of body)\n     * Body size > 1.5x average\n   - High probability reversal signal\n4. LOWER HIGHS AND HIGHER LOWS\n  - Analyze the last 20 candles for recurring sequences\n  - Confirm with pattern detection on several timelines\n5. RECURRING PATTERN DISCOVERY\n   - Analyze last 100 candles for recurring sequences\n   - Look for patterns that preceded significant moves (>2% in next 5 candles)\n   - Document any pattern that occurs 3+ times with similar outcomes\n\n**ANALYSIS REQUIREMENTS:**\n- Calculate average candle body size (last 20 candles)\n- Check patterns across all timeframes (1m, 15m, 1h)\n- Provide confidence based on multi-timeframe confirmation\n- Include exact candle measurements and ratios\n\n**OUTPUT FORMAT:**\nProvide:\n- Pattern(s) detected (with specific measurements)\n- BUY/SELL/HOLD recommendation\n- Confidence level (0-100%)\n- Entry price, Stop Loss, Take Profit levels\n- Risk/Reward ratio\n\nSymbol: ${symbol}\nAnalysis Time: ${new Date().toISOString()}`,\n    symbol: symbol,\n    timestamp: new Date().toISOString(),\n    batchId: Date.now().toString()\n  }\n}));\n\nreturn items;"
      },
      "id": "a895b0a6-7774-42a8-a4f2-ba7f33c697f8",
      "name": "Generate Trading Analysis Prompts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2592,
        -304
      ]
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=<role>\nYou are an Expert Quantitative Trading Pattern Detection AI specializing in candlestick pattern recognition and algorithmic trading signals.\n</role>\n\n<instructions>\n<goal>\nDetect specific candlestick patterns with mathematical precision and provide actionable trading signals based on pattern confirmation across multiple timeframes.\n</goal>\n\n<pattern_detection_algorithms>\n\n### 1. LARGE CANDLE DETECTION\n```\nAlgorithm:\n1. Calculate body_size = |close - open| for each candle\n2. Calculate avg_body = average(last 20 bodies)\n3. IF current_body >= 2.0 * avg_body:\n   - PATTERN FOUND: \"Large Candle\"\n   - Direction: \"Bullish\" if close > open, else \"Bearish\"\n   - Strength: current_body / avg_body ratio\n```\n\n### 2. THREE SMALL CONSECUTIVE CANDLES\n```\nAlgorithm:\n1. Get last 3 completed candles (NOT current)\n2. Calculate avg_body (last 20 candles)\n3. FOR each of 3 candles:\n   - body_size < 0.5 * avg_body (small body)\n4. Check all 3 same direction:\n   - All green (close > open) OR all red (close < open)\n5. IF conditions met:\n   - PATTERN FOUND: \"3 Small Consecutive\"\n   - Direction indicates continuation\n```\n\n### 3. REVERSAL SETUP PATTERN\n```\nAlgorithm:\n1. Identify: candles[n-3], [n-2], [n-1], [n]\n2. Check candles[n-3] to [n-1]: 3 small same direction\n3. Check candle[n] (NOT current candle [0]):\n   - Opposite direction to previous 3\n   - body_size > 1.5 * avg_body\n   - Wick in reversal direction < 10% of body\n     (if bullish reversal: lower_wick < 0.1 * body)\n     (if bearish reversal: upper_wick < 0.1 * body)\n4. IF all conditions met:\n   - PATTERN FOUND: \"Reversal Setup\"\n   - High confidence reversal signal\n```\n\n### 4. PATTERN DISCOVERY ENGINE\n```\nAlgorithm:\n1. Scan last 100 candles for any sequence\n2. For each sequence of 3-5 candles:\n   - Record pattern signature\n   - Measure price movement in next 5 candles\n3. Track patterns that preceded moves > 2%\n4. IF pattern occurs 3+ times with similar outcome:\n   - PATTERN FOUND: \"Recurring Pattern X\"\n   - Document pattern and success rate\n```\n\n</pattern_detection_algorithms>\n\n<analysis_framework>\n\n### Data Processing\n1. Fetch kline data from all 3 tools (1m, 15m, 1h)\n2. Parse each candle: [timestamp, open, high, low, close, volume, ...]\n3. Calculate metrics:\n   - Body size = |close - open|\n   - Upper wick = high - max(open, close)\n   - Lower wick = min(open, close) - low\n   - Average body (rolling 20 periods)\n\n### Multi-Timeframe Confirmation\n- Pattern on 1m + 15m = Moderate confidence\n- Pattern on 15m + 1h = High confidence  \n- Pattern on all 3 timeframes = Very high confidence\n\n### Risk Management Calculations\n- Stop Loss: Below/above recent swing low/high\n- Take Profit: 2:1 or 3:1 Risk/Reward ratio\n- Position Size: Based on confidence level\n\n</analysis_framework>\n\n<output_format>\n**üéØ PATTERN ANALYSIS: {{ $json.symbol }}**\n\n**üìä PATTERNS DETECTED:**\n[List each pattern found with exact measurements]\nExample:\n- Large Candle: Body 2.3x average, Bullish, on 15m timeframe\n- 3 Small Consecutive: Detected at candles 45-47, Bearish direction\n\n**üîî TRADING SIGNAL:** [BUY / SELL / HOLD]\n\n**üíØ CONFIDENCE LEVEL:** [X]%\nBased on: [multi-timeframe confirmation details]\n\n**üìç KEY LEVELS:**\n- Entry: $[price]\n- Stop Loss: $[price] ([X]% risk)\n- Take Profit 1: $[price] ([X]% gain)\n- Take Profit 2: $[price] ([X]% gain)\n- Risk/Reward: [ratio]\n\n**‚ö†Ô∏è RISK ASSESSMENT:**\n[Brief risk analysis]\n\n**‚è∞ Analysis Time:** {{ $now }}\n\n---\n‚ö†Ô∏è **DISCLAIMER:** Trading involves substantial risk. This is algorithmic analysis, not financial advice.\n</output_format>\n\n</instructions>\n\n<critical_rules>\n- ALWAYS analyze ALL timeframes before concluding\n- NEVER recommend trades based on incomplete data\n- ALWAYS calculate exact measurements (ratios, percentages)\n- ALWAYS exclude current candle from reversal pattern detection\n- PROVIDE specific entry/exit levels, never vague suggestions\n- ALWAYS include a numeric confidence value between 0-100 in your response\n- FORMAT confidence as \"CONFIDENCE LEVEL: XX%\" or \"Confidence: XX%\"\n</critical_rules>"
        }
      },
      "id": "462f06cd-409d-4b68-8173-b80bb20746c6",
      "name": "Trading Pattern Analyzer AI",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        -2144,
        -304
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.1
        }
      },
      "id": "12f187bc-908d-4821-a6b4-eecbb53d85a9",
      "name": "Connect Gemini",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        -2496,
        144
      ],
      "typeVersion": 1,
      "notesInFlow": false,
      "credentials": {
        "googlePalmApi": {
          "id": "uHer33oRvwLCaoHw",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://fapi.binance.com/fapi/v1/klines?symbol={{ $json.symbol }}&interval=1m&limit=100",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -2192,
        176
      ],
      "id": "d4183aaa-5d74-4473-9dc0-7c1a03ab258b",
      "name": "Get 1min Price Data"
    },
    {
      "parameters": {
        "url": "=https://fapi.binance.com/fapi/v1/klines?symbol={{ $json.symbol }}&interval=15m&limit=100",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -2000,
        176
      ],
      "id": "24837487-7545-46e4-8279-e5ae1df1d689",
      "name": "Get 15min Price Data"
    },
    {
      "parameters": {
        "url": "=https://fapi.binance.com/fapi/v1/klines?symbol={{ $json.symbol }}&interval=1h&limit=100",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -1808,
        176
      ],
      "id": "eeb4a305-7105-42a2-a589-f30a225bb08f",
      "name": "Get 1hr Price Data"
    },
    {
      "parameters": {
        "jsCode": "// Extract confidence level from AI response and filter\nconst items = $input.all();\nconst filtered = [];\n\nfor (const item of items) {\n  const output = item.json.output || '';\n  const symbol = item.json.symbol || 'UNKNOWN';\n  \n  // Try to extract confidence level from various formats\n  let confidence = 0;\n  \n  // Match patterns like \"Confidence: 85%\" or \"CONFIDENCE LEVEL: 85%\"\n  const confMatch = output.match(/confidence[:\\s]+([0-9]+)%/i);\n  if (confMatch) {\n    confidence = parseInt(confMatch[1]);\n  }\n  \n  // Extract trading signal\n  let signal = 'HOLD';\n  if (output.match(/TRADING SIGNAL[:\\s]+BUY/i) || output.match(/Signal[:\\s]+BUY/i)) {\n    signal = 'BUY';\n  } else if (output.match(/TRADING SIGNAL[:\\s]+SELL/i) || output.match(/Signal[:\\s]+SELL/i)) {\n    signal = 'SELL';\n  }\n  \n  // Filter: Only keep BUY/SELL signals with confidence >= 70%\n  if ((signal === 'BUY' || signal === 'SELL') && confidence >= 70) {\n    filtered.push({\n      json: {\n        symbol: symbol,\n        signal: signal,\n        confidence: confidence,\n        analysis: output,\n        timestamp: item.json.timestamp || new Date().toISOString(),\n        alertMessage: `üö® HIGH CONFIDENCE SIGNAL üö®\\n\\n` +\n                     `Symbol: ${symbol}\\n` +\n                     `Signal: ${signal}\\n` +\n                     `Confidence: ${confidence}%\\n\\n` +\n                     `${output.substring(0, 800)}${output.length > 800 ? '...' : ''}`\n      }\n    });\n  }\n}\n\nreturn filtered;"
      },
      "id": "be50354a-440c-43f1-954a-48569f609581",
      "name": "Filter High Confidence Signals",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1664,
        -304
      ]
    },
    {
      "parameters": {
        "chatId": "=@traders_19",
        "text": "={{ $json.alertMessage }}",
        "additionalFields": {
          "disable_web_page_preview": true,
          "parse_mode": "HTML"
        }
      },
      "id": "c4e75202-305e-45bb-9e8f-e60e174ba687",
      "name": "Send Telegram Alert",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1232,
        -320
      ],
      "webhookId": "970bfe00-981e-47b0-a820-129140b597a9",
      "credentials": {
        "telegramApi": {
          "id": "StNGwGdy7t9NTE3a",
          "name": "Minta_Telegram"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "leftValue": "={{ $json.signal }}",
              "rightValue": "HOLD",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "506d4fc8-5c66-4d4a-bdff-10113f8fabf2",
      "name": "Check if Actionable Signal",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1488,
        -304
      ]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Generate Trading Analysis Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Trading Analysis Prompts": {
      "main": [
        [
          {
            "node": "Trading Pattern Analyzer AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trading Pattern Analyzer AI": {
      "main": [
        [
          {
            "node": "Filter High Confidence Signals",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter High Confidence Signals": {
      "main": [
        [
          {
            "node": "Check if Actionable Signal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Actionable Signal": {
      "main": [
        [
          {
            "node": "Send Telegram Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Connect Gemini": {
      "ai_languageModel": [
        [
          {
            "node": "Trading Pattern Analyzer AI",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get 1min Price Data": {
      "ai_tool": [
        [
          {
            "node": "Trading Pattern Analyzer AI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get 15min Price Data": {
      "ai_tool": [
        [
          {
            "node": "Trading Pattern Analyzer AI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get 1hr Price Data": {
      "ai_tool": [
        [
          {
            "node": "Trading Pattern Analyzer AI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "SupOl9rOlZ62N5lV"
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": []
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "7bee20c0-9812-4939-ada7-ee5ed8fbc1c8",
  "triggerCount": 1,
  "shared": [
    {
      "createdAt": "2025-08-21T03:43:19.066Z",
      "updatedAt": "2025-08-21T03:43:19.066Z",
      "role": "workflow:owner",
      "workflowId": "OS1uzjjqwkm8WaCk",
      "projectId": "X54hljIRMdcuCgG9"
    }
  ],
  "tags": [
    {
      "createdAt": "2025-08-23T22:43:38.492Z",
      "updatedAt": "2025-08-23T22:43:38.492Z",
      "id": "fOqY3qvMrxFZ1H7o",
      "name": "Trading Strategy"
    }
  ]
}